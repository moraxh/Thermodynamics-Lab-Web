<div id="tabSelector" class="flex flex-wrap bg-gray0 outline-2 outline-gray1 rounded-lg text-text overflow-hidden">
  <button data-section="publications" class="active">Publicaciones</button>
  <button data-section="articles">Art√≠culos</button>
  <button data-section="videos">Videos</button>
  <button data-section="educationalMaterial">Recursos Educativos</button>
  <button data-section="events">Eventos</button>
</div>

<article id="tabsSections" class="flex justify-center w-full">
  <div id="publications">
    <slot name="publications"/>
  </div>

  <div id="articles" class="!hidden">
    <slot name="articles"/>
  </div>

  <div id="videos" class="!hidden">
    <slot name="videos"/>
  </div>

  <div id="educationalMaterial" class="!hidden">
    <slot name="educationalMaterial"/>
  </div>

  <div id="events" class="!hidden">
    <slot name="events"/>
  </div>
</article>

<style>
  @import "../../../../styles/global.css";

  #tabsSections > div {
    @apply max-w-full;
  }

  #tabSelector > button {
    @apply xs:w-54 w-full py-3 text-lg font-bold hover:bg-gray1 hover:cursor-pointer transition-all duration-200 ease-in-out;
  }

  #tabSelector > button.active {
    @apply border-accent border-b-4 bg-gray1;
  }

  section {
    @apply flex flex-col gap-5 justify-start items-start w-full max-w-7xl;
  }
</style>

<script>
  const handleTabs = () => {
    const tabSelector = document.getElementById("tabSelector")
    const sections = document.querySelectorAll("#tabsSections > div")

    if (!tabSelector || sections.length == 0) return

    // Function to activate a specific tab
    const activateTab = (targetSection: string) => {
      // Remove all active classes from buttons
      tabSelector.querySelectorAll(".active").forEach((activeButton) => {
        activeButton.classList.remove("active")
      })

      // Hide all sections
      sections.forEach((section) => {
        section.classList.add("!hidden")
      })

      // Find and activate the target button
      const targetButton = tabSelector.querySelector(`[data-section="${targetSection}"]`)
      if (targetButton) {
        targetButton.classList.add("active")
      }

      // Show the target section
      const targetSectionElement = document.getElementById(targetSection)
      if (targetSectionElement) {
        targetSectionElement.classList.remove("!hidden")
      }
    }

    // Function to get current tab from URL
    const getCurrentTabFromURL = () => {
      const urlParams = new URLSearchParams(window.location.search)
      return urlParams.get('tab') || 'publications' // Default to publications
    }

    // Function to update URL with current tab
    const updateURL = (tab: string) => {
      const url = new URL(window.location.href)
      url.searchParams.set('tab', tab)
      window.history.replaceState({}, '', url)
    }

    // Initialize tab based on URL parameter
    const currentTab = getCurrentTabFromURL()
    activateTab(currentTab)

    // Handle the buttons of the tab selector
    tabSelector.querySelectorAll("button").forEach((button) => {
      button.addEventListener("click", () => {
        const sectionToShow = button.getAttribute("data-section")
        
        if (!sectionToShow) return

        // Activate the tab
        activateTab(sectionToShow)
        
        // Update URL
        updateURL(sectionToShow)
      })
    }) 
  }

  document.addEventListener("astro:page-load", handleTabs)
</script>